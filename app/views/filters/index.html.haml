%h1 Listing users

%table
  %thead
    %tr
      %th Name
      %th Email
      - @current_survey.sections.each do |section|
        - section.questions.each do |question|
          -# TODO Change to question.short_text once surveys are fixed to actually have short_text
          %th= question.text
      %th.actions

  %tbody
    - @users.each do |user|
      %tr
        %td= user.name
        %td= user.email
        - @current_survey.sections.each do |section|
          - section.questions.each do |question|
            - if (response_set = @response_sets.where(user_id: user.id).take).present? && response_set.responses.present? && (response = response_set.responses.where(question_id: question.id).take).present? && (answer = response.answer).present?
              %td= answer_text(answer, response)
            - else
              %td
        %td
          - if policy(:user).show?
            = link_to user, title: 'Show', class: 'icon' do
              = fa_icon 'eye'
          - if policy(:user).edit?
            = link_to edit_user_path(user), title: 'Edit', class: 'icon' do
              = fa_icon 'wrench'
          - if policy(:user).destroy?
            = link_to user, method: :delete, data: { confirm: 'Are you sure?' }, title: 'Destroy', class: 'icon' do
              = fa_icon 'times'

%br
-if policy(:user).new?
  = link_to 'New User', new_user_path
